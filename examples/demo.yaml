debug: true
group_by_restaurant_region:
  class_name: GetCountTransformer
  config:
    count_col: restaurant
    group_by:
    - restaurant
    - region
    - country
    - rating
    input_block: join_tables
join_tables:
  class_name: JoinTransformer
  config:
    join_on:
      read_ratings: id
      read_sales: id
    join_type: inner
map_state_names:
  class_name: MapTransformer
  config:
    col_key: region
    input_block: group_by_restaurant_region
    map_dict:
      Alabama: AL
      Alaska: AK
      Arizona: AZ
      Arkansas: AR
      California: CA
      Colorado: CO
      Connecticut: CT
      Delaware: DE
      Florida: FL
      Georgia: GA
      Hawaii: HI
      Idaho: ID
      Illinois: IL
      Indiana: IN
      Iowa: IA
      Kansas: KS
      Kentucky: KY
      Louisiana: LA
      Maine: ME
      Maryland: MD
      Massachusetts: MA
      Michigan: MI
      Minnesota: MN
      Mississippi: MS
      Missouri: MO
      Montana: MT
      Nebraska: NE
      Nevada: NV
      New Hampshire: NH
      New Jersey: NJ
      New Mexico: NM
      New York: NY
      North Carolina: NC
      North Dakota: ND
      Ohio: OH
      Oklahoma: OK
      Oregon: OR
      Pennsylvania: PA
      Rhode Island: RI
      South Carolina: SC
      South Dakota: SD
      Tennessee: TN
      Texas: TX
      Utah: UT
      Vermont: VT
      Virginia: VA
      Washington: WA
      West Virginia: WV
      Wisconsin: WI
      Wyoming: WY
    name: state_abbreviation
pivot:
  class_name: PivotTransformer
  config:
    aggregate_type: avg
    column_level: state_abbreviation
    input_block: map_state_names
    row_level: restaurant
    sum_col: rating
read_ratings:
  class_name: AmazonS3Reader
  config:
    aws_access_key_id: AKIA3TOV3GZZHAH4MPAE
    aws_secret_access_key: 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
    bucket_name: serrademo
    file_path: rating.csv
    file_type: csv
read_sales:
  class_name: AmazonS3Reader
  config:
    aws_access_key_id: AKIA3TOV3GZZHAH4MPAE
    aws_secret_access_key: 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
    bucket_name: serrademo
    file_path: sales.csv
    file_type: csv
step_write:
  class_name: S3Writer
  config:
    format: csv
    input_block: pivot
    path: s3://myprefix/mypath
