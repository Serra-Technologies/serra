debug: true

read_sales:
  class_name: AmazonS3Reader
  config:
    aws_access_key_id: AKIA3TOV3GZZHAH4MPAE
    aws_secret_access_key: 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
    bucket_name: serrademo
    file_path: sales.csv
    file_type: csv

read_ratings:
  class_name: AmazonS3Reader
  config:
    aws_access_key_id: AKIA3TOV3GZZHAH4MPAE
    aws_secret_access_key: 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
    bucket_name: serrademo
    file_path: rating_df.csv
    file_type: csv

join_tables:
  class_name: JoinTransformer
  config:
    join_type: 'inner'
    join_on:
      read_sales: restaurant
      read_ratings: id

map_state_names:
  class_name: MapTransformer
  config:
    input_block: join_tables
    name: 'region_abbr'
    map_dict:
        Alabama: 'AL'
        Alaska: 'AK'
        Arizona: 'AZ'
        Arkansas: 'AR'
        California: 'CA'
        Colorado: 'CO'
        Connecticut: 'CT'
        Delaware: 'DE'
        Florida: 'FL'
        Georgia: 'GA'
        Hawaii: 'HI'
        Idaho: 'ID'
        Illinois: 'IL'
        Indiana: 'IN'
        Iowa: 'IA'
        Kansas: 'KS'
        Kentucky: 'KY'
        Louisiana: 'LA'
        Maine: 'ME'
        Maryland: 'MD'
        Massachusetts: 'MA'
        Michigan: 'MI'
        Minnesota: 'MN'
        Mississippi: 'MS'
        Missouri: 'MO'
        Montana: 'MT'
        Nebraska: 'NE'
        Nevada: 'NV'
        New Hampshire: 'NH'
        New Jersey: 'NJ'
        New Mexico: 'NM'
        New York: 'NY'
        North Carolina: 'NC'
        North Dakota: 'ND'
        Ohio: 'OH'
        Oklahoma: 'OK'
        Oregon: 'OR'
        Pennsylvania: 'PA'
        Rhode Island: 'RI'
        South Carolina: 'SC'
        South Dakota: 'SD'
        Tennessee: 'TN'
        Texas: 'TX'
        Utah: 'UT'
        Vermont: 'VT'
        Virginia: 'VA'
        Washington: 'WA'
        West Virginia: 'WV'
        Wisconsin: 'WI'
        Wyoming: 'WY'
    col_key: 'region'
  
cast_ratings:
  class_name: CastColumnTransformer
  config:
    input_block: map_state_names
    cast_columns:
      rating: ['rating', 'double']

pivot:
  class_name: PivotTransformer
  config:
    input_block: cast_ratings
    row_level: 'restaurant'
    column_level: "region"
    aggregate_type: "avg"
    sum_col: "customers"

step_write:
  class_name: LocalWriter
  config:
    input_block: pivot
    file_path: "./examples/outputalan.csv"
